<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡å›­æ–‡åŒ–äº’åŠ¨å¹³å° - å®æ—¶äº¤äº’ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --text-color: #333;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            background: white;
            border-radius: 15px;
            padding: 15px 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .logo i {
            color: var(--primary-color);
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--dark-color);
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background: var(--primary-color);
            color: white;
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* ä¸»è¦å†…å®¹åŒº */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* å†…å®¹å¡ç‰‡ */
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }
        
        .content-card:hover {
            transform: translateY(-5px);
        }
        
        /* å¿ƒè·³åŠ¨ç”» */
        .heartbeat-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .heartbeat {
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            position: relative;
            cursor: pointer;
            user-select: none;
        }
        
        .heartbeat::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            animation: pulse 1.5s infinite;
            z-index: -1;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .heartbeat.active {
            background: var(--accent-color);
            animation: heartbeat 0.5s;
        }
        
        @keyframes heartbeat {
            0% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* å®æ—¶æ•°æ® */
        .real-time-data {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .data-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        /* å¤šåª’ä½“å±•ç¤ºå¢™ */
        .media-wall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .media-item {
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
            height: 200px;
        }
        
        .media-item:hover {
            transform: scale(1.03);
        }
        
        .media-item img, .media-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .media-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        
        .media-item:hover .media-overlay {
            transform: translateY(0);
        }
        
        /* æƒ…ç»ªåé¦ˆç³»ç»Ÿ */
        .emoji-feedback {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .emoji-btn {
            background: white;
            border: 2px solid #ddd;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .emoji-btn:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
        }
        
        .emoji-btn.active {
            border-color: var(--primary-color);
            background: #e3f2fd;
        }
        
        /* å¼¹å¹•ç³»ç»Ÿ */
        .danmaku-container {
            height: 300px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-top: 20px;
            background: #f8f9fa;
        }
        
        .danmaku {
            position: absolute;
            white-space: nowrap;
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            animation: danmaku-move linear forwards;
        }
        
        @keyframes danmaku-move {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
        }
        
        /* ååŒç”»å¸ƒ */
        .collaborative-canvas-container {
            height: 300px;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
            position: relative;
        }
        
        #collaborative-canvas {
            width: 100%;
            height: 100%;
            background: white;
            cursor: crosshair;
        }
        
        .canvas-tools {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
        }
        
        .canvas-tool {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #ddd;
            cursor: pointer;
        }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* åœ¨çº¿ç”¨æˆ· */
        .online-users {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .user-list {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* å®æ—¶é€šçŸ¥ */
        .live-notifications {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            max-height: 300px;
            overflow-y: auto;
        }
        
        .notification {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* è¯„è®ºç³»ç»Ÿ */
        .comment-section {
            margin-top: 20px;
        }
        
        .comment-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .comment-input textarea {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            resize: vertical;
            min-height: 80px;
        }
        
        .comment {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        /* æ—¶ç©ºèƒ¶å›Š */
        .time-capsule {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
            border-left: 5px solid #e74c3c;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ - æ–°å¢ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 1200px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.4s;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            z-index: 10;
        }
        
        .close-modal:hover {
            color: var(--accent-color);
        }
        
        /* åˆ†çº§é¡µé¢æ ·å¼ - æ–°å¢ */
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .detail-title {
            font-size: 2rem;
            color: var(--dark-color);
            margin-bottom: 10px;
        }
        
        .detail-meta {
            display: flex;
            gap: 20px;
            color: #666;
            font-size: 0.95rem;
        }
        
        .detail-meta i {
            margin-right: 5px;
            color: var(--primary-color);
        }
        
        .detail-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .gallery-item {
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
            height: 220px;
        }
        
        .gallery-item:hover {
            transform: scale(1.02);
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .gallery-item .caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 10px 15px;
            font-size: 0.9rem;
        }
        
        .detail-description {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            line-height: 1.8;
        }
        
        .detail-description h3 {
            color: var(--dark-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .related-works {
            margin-top: 30px;
        }
        
        .related-title {
            font-size: 1.5rem;
            color: var(--dark-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .related-item {
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            height: 150px;
            position: relative;
        }
        
        .related-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .related-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .related-item .title {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            font-size: 0.85rem;
            text-align: center;
        }
        
        .detail-interaction {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        .interaction-buttons {
            display: flex;
            gap: 15px;
        }
        
        .interaction-btn {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .interaction-btn.like {
            background: #e3f2fd;
            color: var(--primary-color);
        }
        
        .interaction-btn.like:hover {
            background: #bbdefb;
        }
        
        .interaction-btn.share {
            background: #f3e5f5;
            color: #9c27b0;
        }
        
        .interaction-btn.share:hover {
            background: #e1bee7;
        }
        
        .interaction-btn.save {
            background: #e8f5e9;
            color: #4caf50;
        }
        
        .interaction-btn.save:hover {
            background: #c8e6c9;
        }
        
        .author-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #f5f7fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .author-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .author-details h4 {
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .author-details p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .media-wall, .detail-gallery {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
            
            .media-wall {
                grid-template-columns: 1fr;
            }
            
            .detail-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .detail-interaction {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .interaction-buttons {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-university"></i>
            <span>æ ¡å›­æ–‡åŒ–äº’åŠ¨å¹³å°</span>
        </div>
        <div class="nav-links">
            <a href="#" class="active"><i class="fas fa-home"></i> é¦–é¡µ</a>
            <a href="#"><i class="fas fa-map-marked-alt"></i> æ–‡åŒ–åœ°å›¾</a>
            <a href="#"><i class="fas fa-calendar-alt"></i> æ´»åŠ¨æ—¥å†</a>
            <a href="#"><i class="fas fa-paint-brush"></i> åˆ›æ„å·¥åŠ</a>
            <a href="#"><i class="fas fa-microphone-alt"></i> äººç‰©è®¿è°ˆ</a>
            <a href="#"><i class="fas fa-store"></i> çºªå¿µå“å•†åŸ</a>
        </div>
        <div class="user-info">
            <span id="current-user">å½“å‰ç”¨æˆ·: å°æ˜</span>
            <button onclick="switchUser()" style="margin-left: 10px; padding: 5px 10px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">åˆ‡æ¢ç”¨æˆ·</button>
        </div>
    </nav>

    <div class="container">
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- å¿ƒè·³å®æ—¶åé¦ˆç³»ç»Ÿ -->
            <div class="content-card">
                <h2><i class="fas fa-heartbeat"></i> å®æ—¶äº’åŠ¨åé¦ˆç³»ç»Ÿ</h2>
                <div class="heartbeat-container">
                    <div>
                        <h3>å†…å®¹çƒ­åº¦: <span id="content-title">æ ¡å›­è‰ºæœ¯èŠ‚ç²¾å½©å›é¡¾</span></h3>
                        <p>å½“å‰åœ¨çº¿äº’åŠ¨äººæ•°: <span id="online-count">24</span> äºº</p>
                    </div>
                    <div class="heartbeat" id="heartbeat" onclick="toggleHeartbeat()">
                        <i class="fas fa-heart"></i>
                        <div class="heartbeat-count" id="heartbeat-count">156</div>
                    </div>
                </div>
                
                <div class="real-time-data">
                    <div class="data-item">
                        <i class="fas fa-eye"></i>
                        <span>æµè§ˆé‡: <span id="view-count">1,245</span></span>
                    </div>
                    <div class="data-item">
                        <i class="fas fa-comments"></i>
                        <span>è¯„è®ºæ•°: <span id="comment-count">48</span></span>
                    </div>
                    <div class="data-item">
                        <i class="fas fa-share"></i>
                        <span>åˆ†äº«æ•°: <span id="share-count">32</span></span>
                    </div>
                </div>
                
                <!-- çƒ­åº¦è¶‹åŠ¿å›¾ -->
                <div style="margin-top: 20px; height: 200px;">
                    <canvas id="heat-chart"></canvas>
                </div>
            </div>

            <!-- æƒ…ç»ªå…±é¸£åé¦ˆç³»ç»Ÿ -->
            <div class="content-card">
                <h2><i class="fas fa-smile"></i> æƒ…ç»ªå…±é¸£åé¦ˆ</h2>
                <p>é€‰æ‹©ä½ å¯¹è¿™ä¸ªå†…å®¹çš„æƒ…ç»ªååº”:</p>
                
                <div class="emoji-feedback">
                    <div class="emoji-btn" data-emoji="like" onclick="addEmojiFeedback('like')">
                        ğŸ‘
                        <span class="emoji-count" id="like-count">42</span>
                    </div>
                    <div class="emoji-btn" data-emoji="love" onclick="addEmojiFeedback('love')">
                        â¤ï¸
                        <span class="emoji-count" id="love-count">28</span>
                    </div>
                    <div class="emoji-btn" data-emoji="funny" onclick="addEmojiFeedback('funny')">
                        ğŸ˜‚
                        <span class="emoji-count" id="funny-count">15</span>
                    </div>
                    <div class="emoji-btn" data-emoji="inspire" onclick="addEmojiFeedback('inspire')">
                        ğŸ’¡
                        <span class="emoji-count" id="inspire-count">36</span>
                    </div>
                    <div class="emoji-btn" data-emoji="respect" onclick="addEmojiFeedback('respect')">
                        ğŸ‘
                        <span class="emoji-count" id="respect-count">19</span>
                    </div>
                </div>
                
                <!-- æƒ…ç»ªåˆ†å¸ƒå›¾ -->
                <div style="margin-top: 20px; height: 200px;">
                    <canvas id="emotion-chart"></canvas>
                </div>
            </div>

            <!-- å¤šåª’ä½“å±•ç¤ºå¢™ -->
            <div class="content-card">
                <h2><i class="fas fa-images"></i> åˆ›æ„å·¥åŠ - å¤šåª’ä½“å±•ç¤ºå¢™</h2>
                <p class="section-description">ç‚¹å‡»ä»»æ„ä½œå“æŸ¥çœ‹è¯¦ç»†å†…å®¹å’Œæ›´å¤šç›¸å…³ä½œå“</p>
                <div class="media-wall" id="media-wall">
                    <!-- åŠ¨æ€ç”Ÿæˆåª’ä½“å†…å®¹ -->
                </div>
            </div>

            <!-- ååŒç”»å¸ƒ -->
            <div class="content-card">
                <h2><i class="fas fa-paint-brush"></i> å®æ—¶ååŒç”»å¸ƒ</h2>
                <p>ä¸å…¶ä»–åœ¨çº¿ç”¨æˆ·å…±åŒç»˜åˆ¶æ ¡å›­æ–‡åŒ–åœ°å›¾ (å½“å‰åœ¨çº¿ç»˜åˆ¶è€…: <span id="canvas-users">3</span>äºº)</p>
                
                <div class="collaborative-canvas-container">
                    <canvas id="collaborative-canvas" width="800" height="300"></canvas>
                    <div class="canvas-tools">
                        <div class="canvas-tool" style="background: #e74c3c;" onclick="changeColor('#e74c3c')"></div>
                        <div class="canvas-tool" style="background: #3498db;" onclick="changeColor('#3498db')"></div>
                        <div class="canvas-tool" style="background: #2ecc71;" onclick="changeColor('#2ecc71')"></div>
                        <div class="canvas-tool" onclick="clearCanvas()">
                            <i class="fas fa-eraser"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¼¹å¹•è¯„è®ºç³»ç»Ÿ -->
            <div class="content-card">
                <h2><i class="fas fa-comment-dots"></i> å®æ—¶å¼¹å¹•è¯„è®º</h2>
                <div class="danmaku-container" id="danmaku-container">
                    <!-- å¼¹å¹•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="comment-input">
                    <input type="text" id="danmaku-input" placeholder="è¾“å…¥å¼¹å¹•å†…å®¹..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <button onclick="sendDanmaku()" style="padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">å‘é€å¼¹å¹•</button>
                </div>
            </div>

            <!-- æ—¶ç©ºèƒ¶å›Šè¯„è®º -->
            <div class="content-card">
                <h2><i class="fas fa-capsules"></i> æ—¶ç©ºèƒ¶å›Šè¯„è®ºç³»ç»Ÿ</h2>
                
                <div class="time-capsule">
                    <h4><i class="fas fa-clock"></i> æœªæ¥ç•™è¨€ - æ¯•ä¸šç¥ç¦</h4>
                    <p>"è‡´2024å±Šæ¯•ä¸šç”Ÿï¼šæ„¿ä½ ä»¬å‰ç¨‹ä¼¼é”¦ï¼Œå¸¸å›æ¯æ ¡çœ‹çœ‹ï¼"</p>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                        <span>å‘å¸ƒè€…: ç‹è€å¸ˆ</span>
                        <span>è§£é”æ—¶é—´: 2024-06-30</span>
                    </div>
                </div>
                
                <div class="comment-section">
                    <h3>å‘è¡¨æ—¶ç©ºèƒ¶å›Šè¯„è®º</h3>
                    <div class="comment-input">
                        <textarea id="capsule-comment" placeholder="å†™ä¸‹ä½ æƒ³åœ¨æœªæ¥æŸä¸ªæ—¶é—´å…¬å¼€çš„ç•™è¨€..."></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span>è®¾ç½®è§£é”æ—¶é—´:</span>
                        <input type="date" id="unlock-date" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <button onclick="addTimeCapsule()" style="padding: 10px 20px; background: var(--secondary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">åˆ›å»ºæ—¶ç©ºèƒ¶å›Š</button>
                    </div>
                </div>
            </div>

            <!-- è¯„è®ºç³»ç»Ÿ -->
            <div class="content-card">
                <h2><i class="fas fa-comments"></i> å®æ—¶è¯„è®ºäº’åŠ¨</h2>
                <div class="comment-section">
                    <div class="comment-input">
                        <textarea id="new-comment" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..."></textarea>
                        <button onclick="addComment()" style="padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer; align-self: flex-end;">å‘è¡¨è¯„è®º</button>
                    </div>
                    
                    <div id="comments-container">
                        <!-- è¯„è®ºå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <!-- åœ¨çº¿ç”¨æˆ· -->
            <div class="online-users">
                <h3><i class="fas fa-users"></i> å½“å‰åœ¨çº¿ç”¨æˆ· (<span id="online-users-count">12</span>)</h3>
                <div class="user-list" id="user-list">
                    <!-- åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ -->
                </div>
            </div>

            <!-- å®æ—¶é€šçŸ¥ -->
            <div class="live-notifications">
                <h3><i class="fas fa-bell"></i> å®æ—¶äº’åŠ¨é€šçŸ¥</h3>
                <div id="notifications-container">
                    <!-- é€šçŸ¥å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ARé¢„è§ˆæ¨¡æ‹Ÿ -->
            <div class="content-card">
                <h3><i class="fas fa-vr-cardboard"></i> ARçºªå¿µå“é¢„è§ˆ</h3>
                <div style="text-align: center; margin: 15px 0;">
                    <div style="width: 100%; height: 200px; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; position: relative;">
                        <div style="font-size: 4rem;">ğŸ‘•</div>
                        <div style="position: absolute; bottom: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 5px;">æ ¡å›­æ–‡åŒ–è¡«</div>
                    </div>
                    <p style="margin-top: 10px;">ä½¿ç”¨æ‰‹æœºæ‰«æäºŒç»´ç ä½“éªŒARé¢„è§ˆ</p>
                    <div id="qrcode" style="margin: 10px auto; width: 120px; height: 120px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                        <span style="font-size: 2rem;">ğŸ“±</span>
                    </div>
                </div>
                <button onclick="simulateAR()" style="width: 100%; padding: 10px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">æ¨¡æ‹ŸARé¢„è§ˆæ•ˆæœ</button>
            </div>
        </div>
    </div>

    <!-- åˆ†çº§é¡µé¢æ¨¡æ€æ¡† - æ–°å¢ -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeDetailModal()">&times;</span>
            <div id="detail-content">
                <!-- åˆ†çº§é¡µé¢å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentUser = "å°æ˜";
        let isHeartbeatActive = false;
        let heartbeatCount = 156;
        let onlineUsers = ["å°æ˜", "å°çº¢", "å°åˆš", "æè€å¸ˆ", "ç‹åŒå­¦", "å¼ åŒå­¦", "åˆ˜è€å¸ˆ", "é™ˆåŒå­¦", "èµµåŒå­¦", "å‘¨è€å¸ˆ"];
        let onlineCount = 24;
        let socket = null;
        let canvasContext = null;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentColor = '#e74c3c';
        let canvasUsers = 3;
        
        // æƒ…ç»ªæ•°æ®
        const emotionData = {
            like: 42,
            love: 28,
            funny: 15,
            inspire: 36,
            respect: 19
        };
        
        // è¯„è®ºæ•°æ®
        const comments = [
            {user: "å°çº¢", content: "è¿™ä¸ªæ´»åŠ¨å¤ªç²¾å½©äº†ï¼Œå¸Œæœ›æ¯å¹´éƒ½èƒ½ä¸¾åŠï¼", time: "10åˆ†é’Ÿå‰", avatar: "H"},
            {user: "æè€å¸ˆ", content: "åŒå­¦ä»¬çš„ä½œå“å±•ç°äº†ä¸°å¯Œçš„åˆ›é€ åŠ›å’Œè‰ºæœ¯æ‰åã€‚", time: "25åˆ†é’Ÿå‰", avatar: "L"},
            {user: "ç‹åŒå­¦", content: "æ ¡å›­æ–‡åŒ–è¡«è®¾è®¡å¾—å¾ˆæœ‰ç‰¹è‰²ï¼Œæˆ‘å·²ç»ä¸‹å•äº†ï¼", time: "1å°æ—¶å‰", avatar: "W"}
        ];
        
        // åª’ä½“æ•°æ® - æ‰©å±•ä¸ºåŒ…å«è¯¦ç»†ä¿¡æ¯
        const mediaItems = [
            {
                id: 1,
                type: "image", 
                src: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800&h=600&fit=crop", 
                title: "æ¯•ä¸šå…¸ç¤¼", 
                author: "æ‘„å½±ç¤¾",
                authorAvatar: "S",
                date: "2023-06-15",
                views: 1245,
                likes: 156,
                description: "è¿™æ˜¯æˆ‘æ ¡2023å±Šæ¯•ä¸šå…¸ç¤¼çš„ç²¾å½©ç¬é—´ã€‚æ¯•ä¸šç”Ÿä»¬èº«ç©¿å­¦å£«æœï¼Œåœ¨æ ¡å›­é‡Œç•™ä¸‹äº†éš¾å¿˜çš„å›å¿†ã€‚å…¸ç¤¼ä¸Šï¼Œæ ¡é•¿ä¸ºä¼˜ç§€æ¯•ä¸šç”Ÿé¢å‘äº†è¯ä¹¦ï¼Œå¸ˆç”Ÿä»¬å…±åŒåº†ç¥è¿™ä¸€é‡è¦æ—¶åˆ»ã€‚",
                gallery: [
                    {src: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800&h=600&fit=crop", caption: "æ¯•ä¸šç”Ÿåˆå½±"},
                    {src: "https://images.unsplash.com/photo-1523580494863-6f3031224c94?w=800&h=600&fit=crop", caption: "æ ¡é•¿è‡´è¾"},
                    {src: "https://images.unsplash.com/photo-1546410531-bb4caa6b424d?w=800&h=600&fit=crop", caption: "å­¦ä½æˆäºˆä»ªå¼"},
                    {src: "https://images.unsplash.com/photo-1562774053-701939374585?w=800&h=600&fit=crop", caption: "æ¯•ä¸šç”ŸæŠ›å¸½åº†ç¥"}
                ],
                related: [
                    {id: 2, title: "æ ¡å›­å»ºç­‘", src: "https://images.unsplash.com/photo-1562774053-701939374585?w=400&h=300&fit=crop"},
                    {id: 4, title: "è‰ºæœ¯èŠ‚è¡¨æ¼”", src: "", thumbnail: "ğŸ­"},
                    {id: 5, title: "æ ¡å›­ç§‹è‰²", src: "https://images.unsplash.com/photo-1523580494863-6f3031224c94?w=400&h=300&fit=crop"}
                ]
            },
            {
                id: 2,
                type: "image", 
                src: "https://images.unsplash.com/photo-1562774053-701939374585?w=800&h=600&fit=crop", 
                title: "æ ¡å›­å»ºç­‘", 
                author: "å°åˆš",
                authorAvatar: "X",
                date: "2023-09-10",
                views: 892,
                likes: 98,
                description: "æˆ‘æ ¡æ ‡å¿—æ€§å»ºç­‘â€”â€”å›¾ä¹¦é¦†ä¸å®éªŒæ¥¼ã€‚å›¾ä¹¦é¦†è—ä¹¦ä¸°å¯Œï¼Œæ˜¯åŒå­¦ä»¬å­¦ä¹ ç ”ç©¶çš„å¥½å»å¤„ï¼›å®éªŒæ¥¼è®¾å¤‡å…ˆè¿›ï¼Œä¸ºç§‘ç ”åˆ›æ–°æä¾›äº†ä¼˜è¶Šæ¡ä»¶ã€‚",
                gallery: [
                    {src: "https://images.unsplash.com/photo-1562774053-701939374585?w=800&h=600&fit=crop", caption: "å›¾ä¹¦é¦†å…¨æ™¯"},
                    {src: "https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?w=800&h=600&fit=crop", caption: "å®éªŒæ¥¼å¤–è§‚"},
                    {src: "https://images.unsplash.com/photo-1546410531-bb4caa6b424d?w=800&h=600&fit=crop", caption: "æ•™å­¦æ¥¼èµ°å»Š"},
                    {src: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800&h=600&fit=crop", caption: "æ ¡å›­å…¨æ™¯"}
                ],
                related: [
                    {id: 1, title: "æ¯•ä¸šå…¸ç¤¼", src: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=300&fit=crop"},
                    {id: 3, title: "å›¾ä¹¦é¦†ä¸€è§’", src: "https://images.unsplash.com/photo-1546410531-bb4caa6b424d?w=400&h=300&fit=crop"},
                    {id: 6, title: "å®éªŒå®¤", src: "https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?w=400&h=300&fit=crop"}
                ]
            },
            {
                id: 3,
                type: "image", 
                src: "https://images.unsplash.com/photo-1546410531-bb4caa6b424d?w=800&h=600&fit=crop", 
                title: "å›¾ä¹¦é¦†ä¸€è§’", 
                author: "æè€å¸ˆ",
                authorAvatar: "L",
                date: "2023-11-05",
                views: 756,
                likes: 87,
                description: "å›¾ä¹¦é¦†è‡ªä¹ åŒºçš„å®‰é™å­¦ä¹ ç¯å¢ƒã€‚è¿™é‡Œæ‹¥æœ‰ä¸°å¯Œçš„è—ä¹¦å’Œèˆ’é€‚çš„é˜…è¯»ç©ºé—´ï¼Œæ˜¯åŒå­¦ä»¬è·å–çŸ¥è¯†ã€å®Œæˆå­¦æœ¯ç ”ç©¶çš„é‡è¦åœºæ‰€ã€‚",
                gallery: [
                    {src: "https://images.unsplash.com/photo-1546410531-bb4caa6b424d?w=800&h=600&fit=crop", caption: "è‡ªä¹ åŒºå…¨æ™¯"},
                    {src: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800&h=600&fit=crop", caption: "å›¾ä¹¦å€Ÿé˜…åŒº"},
                    {src: "https://images.unsplash.com/photo-1562774053-701939374585?w=800&h=600&fit=crop", caption: "ç”µå­é˜…è§ˆå®¤"},
                    {src: "https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?w=800&h=600&fit=crop", caption: "è®¨è®ºåŒº"}
                ],
                related: [
                    {id: 2, title: "æ ¡å›­å»ºç­‘", src: "https://images.unsplash.com/photo-1562774053-701939374585?w=400&h=300&fit=crop"},
                    {id: 6, title: "å®éªŒå®¤", src: "https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?w=400&h=300&fit=crop"},
                    {id: 1, title: "æ¯•ä¸šå…¸ç¤¼", src: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=300&fit=crop"}
                ]
            },
            {
                id: 4,
                type: "video", 
                src: "", 
                title: "è‰ºæœ¯èŠ‚è¡¨æ¼”", 
                author: "æ–‡è‰ºéƒ¨",
                authorAvatar: "W",
                date: "2023-05-20",
                views: 2156,
                likes: 324,
                description: "æ ¡å›­è‰ºæœ¯èŠ‚ä¸Šçš„ç²¾å½©è¡¨æ¼”ï¼ŒåŒ…æ‹¬èˆè¹ˆã€éŸ³ä¹ã€æˆå‰§ç­‰å¤šç§è‰ºæœ¯å½¢å¼ã€‚åŒå­¦ä»¬å±•ç°äº†ä¸°å¯Œçš„è‰ºæœ¯æ‰åå’Œåˆ›é€ åŠ›ï¼Œä¸ºå…¨æ ¡å¸ˆç”Ÿå¸¦æ¥äº†ä¸€åœºè§†å¬ç››å®´ã€‚",
                gallery: [
                    {src: "", caption: "èˆè¹ˆè¡¨æ¼”", thumbnail: "ğŸ’ƒ"},
                    {src: "", caption: "ä¹é˜Ÿæ¼”å‡º", thumbnail: "ğŸ¸"},
                    {src: "", caption: "æˆå‰§è¡¨æ¼”", thumbnail: "ğŸ­"},
                    {src: "", caption: "åˆå”±å›¢", thumbnail: "ğŸ¤"}
                ],
                related: [
                    {id: 1, title: "æ¯•ä¸šå…¸ç¤¼", src: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=300&fit=crop"},
                    {id: 5, title: "æ ¡å›­ç§‹è‰²", src: "https://images.unsplash.com/photo-1523580494863-6f3031224c94?w=400&h=300&fit=crop"},
                    {id: 2, title: "æ ¡å›­å»ºç­‘", src: "https://images.unsplash.com/photo-1562774053-701939374585?w=400&h=300&fit=crop"}
                ]
            }
        ];
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // åˆå§‹åŒ–å›¾è¡¨
            initCharts();
            
            // åˆå§‹åŒ–åª’ä½“å¢™
            initMediaWall();
            
            // åˆå§‹åŒ–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
            updateOnlineUsers();
            
            // åˆå§‹åŒ–è¯„è®º
            renderComments();
            
            // åˆå§‹åŒ–ç”»å¸ƒ
            initCanvas();
            
            // åˆå§‹åŒ–å¼¹å¹•
            startDanmaku();
            
            // åˆå§‹åŒ–æ¨¡æ‹ŸWebSocketè¿æ¥
            initSocketConnection();
            
            // æ¨¡æ‹Ÿå®æ—¶æ›´æ–°
            setInterval(updateRealTimeData, 3000);
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            // çƒ­åº¦è¶‹åŠ¿å›¾
            const heatCtx = document.getElementById('heat-chart').getContext('2d');
            const heatChart = new Chart(heatCtx, {
                type: 'line',
                data: {
                    labels: ['9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00'],
                    datasets: [{
                        label: 'å†…å®¹çƒ­åº¦',
                        data: [65, 78, 90, 120, 156, 142, 130],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // æƒ…ç»ªåˆ†å¸ƒå›¾
            const emotionCtx = document.getElementById('emotion-chart').getContext('2d');
            const emotionChart = new Chart(emotionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ğŸ‘ å–œæ¬¢', 'â¤ï¸ æ„ŸåŠ¨', 'ğŸ˜‚ æœ‰è¶£', 'ğŸ’¡ å¯å‘', 'ğŸ‘ æ•¬ä½©'],
                    datasets: [{
                        data: [emotionData.like, emotionData.love, emotionData.funny, emotionData.inspire, emotionData.respect],
                        backgroundColor: [
                            '#3498db',
                            '#e74c3c',
                            '#f1c40f',
                            '#2ecc71',
                            '#9b59b6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            window.heatChart = heatChart;
            window.emotionChart = emotionChart;
        }
        
        // åˆå§‹åŒ–åª’ä½“å¢™
        function initMediaWall() {
            const mediaWall = document.getElementById('media-wall');
            mediaWall.innerHTML = '';
            
            mediaItems.forEach((item, index) => {
                const mediaElement = document.createElement('div');
                mediaElement.className = 'media-item';
                
                if (item.type === 'image') {
                    mediaElement.innerHTML = `
                        <img src="${item.src}" alt="${item.title}" onerror="this.src='https://via.placeholder.com/800x600?text=æ ¡å›­æ–‡åŒ–'">
                        <div class="media-overlay">
                            <h4>${item.title}</h4>
                            <p>ä½œè€…: ${item.author}</p>
                            <p>æµè§ˆé‡: ${item.views} | ç‚¹èµ: ${item.likes}</p>
                        </div>
                    `;
                } else {
                    mediaElement.innerHTML = `
                        <div style="width:100%; height:100%; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:4rem;">
                            ${item.gallery[0].thumbnail || 'ğŸ­'}
                        </div>
                        <div class="media-overlay">
                            <h4>${item.title}</h4>
                            <p>ä½œè€…: ${item.author}</p>
                            <p>æµè§ˆé‡: ${item.views} | ç‚¹èµ: ${item.likes}</p>
                        </div>
                    `;
                }
                
                mediaElement.addEventListener('click', () => openDetailPage(item.id));
                mediaWall.appendChild(mediaElement);
            });
        }
        
        // æ‰“å¼€åˆ†çº§é¡µé¢
        function openDetailPage(itemId) {
            const item = mediaItems.find(i => i.id === itemId);
            if (!item) return;
            
            const modal = document.getElementById('detail-modal');
            const detailContent = document.getElementById('detail-content');
            
            // æ„å»ºåˆ†çº§é¡µé¢å†…å®¹
            let galleryHTML = '';
            item.gallery.forEach((galleryItem, index) => {
                if (item.type === 'image' || galleryItem.src) {
                    galleryHTML += `
                        <div class="gallery-item">
                            <img src="${galleryItem.src}" alt="${galleryItem.caption}" onerror="this.src='https://via.placeholder.com/800x600?text=æ ¡å›­æ–‡åŒ–'">
                            <div class="caption">${galleryItem.caption}</div>
                        </div>
                    `;
                } else {
                    galleryHTML += `
                        <div class="gallery-item" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:3rem;">
                            ${galleryItem.thumbnail || 'ğŸ¬'}
                            <div class="caption">${galleryItem.caption}</div>
                        </div>
                    `;
                }
            });
            
            let relatedHTML = '';
            item.related.forEach(relatedItem => {
                if (relatedItem.src) {
                    relatedHTML += `
                        <div class="related-item" onclick="openDetailPage(${relatedItem.id})">
                            <img src="${relatedItem.src}" alt="${relatedItem.title}" onerror="this.src='https://via.placeholder.com/400x300?text=æ ¡å›­æ–‡åŒ–'">
                            <div class="title">${relatedItem.title}</div>
                        </div>
                    `;
                } else {
                    relatedHTML += `
                        <div class="related-item" onclick="openDetailPage(${relatedItem.id})" style="background:linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); display:flex; align-items:center; justify-content:center; font-size:2.5rem;">
                            ${relatedItem.thumbnail || 'ğŸ¨'}
                            <div class="title">${relatedItem.title}</div>
                        </div>
                    `;
                }
            });
            
            detailContent.innerHTML = `
                <div class="detail-header">
                    <div>
                        <h1 class="detail-title">${item.title}</h1>
                        <div class="detail-meta">
                            <span><i class="fas fa-user"></i> ${item.author}</span>
                            <span><i class="fas fa-calendar"></i> ${item.date}</span>
                            <span><i class="fas fa-eye"></i> ${item.views} æ¬¡æµè§ˆ</span>
                            <span><i class="fas fa-heart"></i> ${item.likes} ä¸ªèµ</span>
                        </div>
                    </div>
                    <div class="detail-interaction">
                        <div class="interaction-buttons">
                            <button class="interaction-btn like" onclick="likeDetailItem(${item.id})">
                                <i class="fas fa-heart"></i> ç‚¹èµ
                            </button>
                            <button class="interaction-btn share" onclick="shareDetailItem(${item.id})">
                                <i class="fas fa-share-alt"></i> åˆ†äº«
                            </button>
                            <button class="interaction-btn save" onclick="saveDetailItem(${item.id})">
                                <i class="fas fa-bookmark"></i> æ”¶è—
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="author-info">
                    <div class="author-avatar">${item.authorAvatar}</div>
                    <div class="author-details">
                        <h4>${item.author}</h4>
                        <p>æ ¡å›­åˆ›æ„å·¥åŠè®¤è¯ä½œè€… | å·²å‘å¸ƒ ${Math.floor(Math.random() * 20) + 5} ä¸ªä½œå“</p>
                    </div>
                </div>
                
                <div class="detail-description">
                    <h3><i class="fas fa-file-alt"></i> ä½œå“æè¿°</h3>
                    <p>${item.description}</p>
                </div>
                
                <h3><i class="fas fa-images"></i> ä½œå“å›¾é›† (${item.gallery.length}å¼ )</h3>
                <div class="detail-gallery">
                    ${galleryHTML}
                </div>
                
                <div class="related-works">
                    <h3 class="related-title"><i class="fas fa-th-large"></i> ç›¸å…³ä½œå“</h3>
                    <div class="related-grid">
                        ${relatedHTML}
                    </div>
                </div>
                
                <div class="comment-section" style="margin-top: 40px;">
                    <h3><i class="fas fa-comments"></i> ä½œå“è¯„è®º (${Math.floor(Math.random() * 50) + 10}æ¡)</h3>
                    <div class="comment-input">
                        <textarea id="detail-comment" placeholder="åˆ†äº«ä½ å¯¹è¿™ä¸ªä½œå“çš„çœ‹æ³•..."></textarea>
                        <button onclick="addDetailComment(${item.id})" style="padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer; align-self: flex-end;">å‘è¡¨è¯„è®º</button>
                    </div>
                    <div id="detail-comments-${item.id}">
                        <!-- ä½œå“è¯„è®ºå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            
            // åˆå§‹åŒ–ä½œå“è¯„è®º
            initDetailComments(item.id);
        }
        
        // å…³é—­åˆ†çº§é¡µé¢
        function closeDetailModal() {
            const modal = document.getElementById('detail-modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
        }
        
        // ç‚¹èµä½œå“
        function likeDetailItem(itemId) {
            const item = mediaItems.find(i => i.id === itemId);
            if (!item) return;
            
            item.likes++;
            
            // æ›´æ–°UI
            const likeBtn = document.querySelector('.interaction-btn.like');
            if (likeBtn) {
                likeBtn.innerHTML = `<i class="fas fa-heart"></i> å·²ç‚¹èµ (${item.likes})`;
                likeBtn.style.background = '#ffcdd2';
                likeBtn.style.color = '#f44336';
                
                // æ·»åŠ é€šçŸ¥
                addNotification(`${currentUser} ç‚¹èµäº†ä½œå“ "${item.title}"`);
            }
        }
        
        // åˆ†äº«ä½œå“
        function shareDetailItem(itemId) {
            const item = mediaItems.find(i => i.id === itemId);
            if (!item) return;
            
            // æ¨¡æ‹Ÿåˆ†äº«åŠŸèƒ½
            const shareUrl = `${window.location.origin}/works/${itemId}`;
            navigator.clipboard.writeText(shareUrl).then(() => {
                alert(`ä½œå“é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š\n${shareUrl}\n\næ‚¨å¯ä»¥å°†å…¶åˆ†äº«ç»™æœ‹å‹ï¼`);
                addNotification(`${currentUser} åˆ†äº«äº†ä½œå“ "${item.title}"`);
            });
        }
        
        // æ”¶è—ä½œå“
        function saveDetailItem(itemId) {
            const item = mediaItems.find(i => i.id === itemId);
            if (!item) return;
            
            const saveBtn = document.querySelector('.interaction-btn.save');
            if (saveBtn) {
                saveBtn.innerHTML = `<i class="fas fa-bookmark"></i> å·²æ”¶è—`;
                saveBtn.style.background = '#c8e6c9';
                saveBtn.style.color = '#388e3c';
                
                // æ·»åŠ é€šçŸ¥
                addNotification(`${currentUser} æ”¶è—äº†ä½œå“ "${item.title}"`);
            }
        }
        
        // åˆå§‹åŒ–ä½œå“è¯„è®º
        function initDetailComments(itemId) {
            const container = document.getElementById(`detail-comments-${itemId}`);
            if (!container) return;
            
            const detailComments = [
                {user: "å¼ åŒå­¦", content: "è¿™ä¸ªä½œå“å¤ªæ£’äº†ï¼Œå¾ˆæœ‰åˆ›æ„ï¼", time: "2å°æ—¶å‰", avatar: "Z"},
                {user: "åˆ˜è€å¸ˆ", content: "ä½“ç°äº†åŒå­¦ä»¬çš„åˆ›é€ åŠ›å’Œè‰ºæœ¯ä¿®å…»ã€‚", time: "3å°æ—¶å‰", avatar: "L"},
                {user: "é™ˆåŒå­¦", content: "æˆ‘ä¹Ÿå‚åŠ äº†è¿™ä¸ªæ´»åŠ¨ï¼ŒçœŸçš„å¾ˆç²¾å½©ï¼", time: "5å°æ—¶å‰", avatar: "C"}
            ];
            
            container.innerHTML = '';
            detailComments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                commentElement.innerHTML = `
                    <div class="user-avatar">${comment.avatar}</div>
                    <div>
                        <div style="font-weight: bold;">${comment.user}</div>
                        <div>${comment.content}</div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">${comment.time}</div>
                    </div>
                `;
                container.appendChild(commentElement);
            });
        }
        
        // æ·»åŠ ä½œå“è¯„è®º
        function addDetailComment(itemId) {
            const input = document.getElementById('detail-comment');
            const text = input.value.trim();
            
            if (text) {
                const container = document.getElementById(`detail-comments-${itemId}`);
                if (!container) return;
                
                const newComment = {
                    user: currentUser,
                    content: text,
                    time: 'åˆšåˆš',
                    avatar: currentUser.charAt(0)
                };
                
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                commentElement.innerHTML = `
                    <div class="user-avatar">${newComment.avatar}</div>
                    <div>
                        <div style="font-weight: bold;">${newComment.user}</div>
                        <div>${newComment.content}</div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">${newComment.time}</div>
                    </div>
                `;
                
                container.insertBefore(commentElement, container.firstChild);
                input.value = '';
                
                // æ·»åŠ é€šçŸ¥
                const item = mediaItems.find(i => i.id === itemId);
                if (item) {
                    addNotification(`${currentUser} è¯„è®ºäº†ä½œå“ "${item.title}"`);
                }
            }
        }
        
        // æ›´æ–°åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
        function updateOnlineUsers() {
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';
            
            // éšæœºæ˜¾ç¤ºéƒ¨åˆ†åœ¨çº¿ç”¨æˆ·
            const displayUsers = [...onlineUsers].sort(() => 0.5 - Math.random()).slice(0, 8);
            
            displayUsers.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'user-avatar';
                userElement.textContent = user.charAt(0);
                userElement.title = user;
                userList.appendChild(userElement);
            });
            
            document.getElementById('online-users-count').textContent = onlineUsers.length;
        }
        
        // åˆ‡æ¢ç”¨æˆ·
        function switchUser() {
            const users = ["å°æ˜", "å°çº¢", "å°åˆš", "æè€å¸ˆ", "ç‹åŒå­¦", "å¼ åŒå­¦"];
            const randomIndex = Math.floor(Math.random() * users.length);
            currentUser = users[randomIndex];
            document.getElementById('current-user').textContent = `å½“å‰ç”¨æˆ·: ${currentUser}`;
            
            // æ·»åŠ é€šçŸ¥
            addNotification(`${currentUser} ä¸Šçº¿äº†`);
        }
        
        // å¿ƒè·³äº¤äº’
        function toggleHeartbeat() {
            const heartbeat = document.getElementById('heartbeat');
            const heartbeatCountElement = document.getElementById('heartbeat-count');
            
            if (!isHeartbeatActive) {
                // æ¿€æ´»å¿ƒè·³
                heartbeat.classList.add('active');
                heartbeatCount++;
                heartbeatCountElement.textContent = heartbeatCount;
                isHeartbeatActive = true;
                
                // æ·»åŠ é€šçŸ¥
                addNotification(`${currentUser} ç‚¹èµäº†å†…å®¹`);
                
                // 3ç§’åé‡ç½®
                setTimeout(() => {
                    heartbeat.classList.remove('active');
                    isHeartbeatActive = false;
                }, 3000);
            }
        }
        
        // æƒ…ç»ªåé¦ˆ
        function addEmojiFeedback(emojiType) {
            emotionData[emojiType]++;
            
            // æ›´æ–°UI
            document.getElementById(`${emojiType}-count`).textContent = emotionData[emojiType];
            
            // æ·»åŠ é€šçŸ¥
            const emojiMap = {
                like: "ç‚¹èµ",
                love: "æ„ŸåŠ¨",
                funny: "è§‰å¾—æœ‰è¶£",
                inspire: "å—åˆ°å¯å‘",
                respect: "è¡¨ç¤ºæ•¬ä½©"
            };
            
            addNotification(`${currentUser} ${emojiMap[emojiType]}äº†å†…å®¹`);
            
            // æ›´æ–°å›¾è¡¨
            window.emotionChart.data.datasets[0].data = [
                emotionData.like,
                emotionData.love,
                emotionData.funny,
                emotionData.inspire,
                emotionData.respect
            ];
            window.emotionChart.update();
            
            // æ·»åŠ è§†è§‰åé¦ˆ
            const emojiBtn = document.querySelector(`[data-emoji="${emojiType}"]`);
            emojiBtn.classList.add('active');
            setTimeout(() => emojiBtn.classList.remove('active'), 1000);
        }
        
        // åˆå§‹åŒ–ç”»å¸ƒ
        function initCanvas() {
            const canvas = document.getElementById('collaborative-canvas');
            canvasContext = canvas.getContext('2d');
            
            // è®¾ç½®ç”»å¸ƒäº‹ä»¶
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // åˆå§‹åŒ–ç”»å¸ƒèƒŒæ™¯
            canvasContext.fillStyle = 'white';
            canvasContext.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶æ ¡å›­åœ°å›¾è½®å»“
            drawCampusMap();
        }
        
        // ç»˜åˆ¶æ ¡å›­åœ°å›¾è½®å»“
        function drawCampusMap() {
            canvasContext.strokeStyle = '#ddd';
            canvasContext.lineWidth = 1;
            
            // ç»˜åˆ¶ç®€å•åœ°å›¾è½®å»“
            canvasContext.beginPath();
            canvasContext.rect(50, 50, 200, 150); // ä¸»æ•™å­¦æ¥¼
            canvasContext.rect(300, 80, 150, 120); // å›¾ä¹¦é¦†
            canvasContext.rect(100, 250, 180, 100); // ä½“è‚²é¦†
            canvasContext.rect(350, 250, 120, 80); // è‰ºæœ¯ä¸­å¿ƒ
            canvasContext.stroke();
            
            // æ·»åŠ æ ‡ç­¾
            canvasContext.fillStyle = '#666';
            canvasContext.font = '12px Arial';
            canvasContext.fillText('ä¸»æ•™å­¦æ¥¼', 120, 140);
            canvasContext.fillText('å›¾ä¹¦é¦†', 350, 140);
            canvasContext.fillText('ä½“è‚²é¦†', 160, 300);
            canvasContext.fillText('è‰ºæœ¯ä¸­å¿ƒ', 380, 290);
        }
        
        // å¼€å§‹ç»˜åˆ¶
        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = getCanvasCoordinates(e);
            
            // æ¨¡æ‹Ÿå…¶ä»–ç”¨æˆ·ä¹Ÿåœ¨ç»˜åˆ¶
            canvasUsers = Math.min(5, canvasUsers + 1);
            document.getElementById('canvas-users').textContent = canvasUsers;
        }
        
        // ç»˜åˆ¶è¿‡ç¨‹
        function draw(e) {
            if (!isDrawing) return;
            
            const [x, y] = getCanvasCoordinates(e);
            
            canvasContext.strokeStyle = currentColor;
            canvasContext.lineWidth = 3;
            canvasContext.lineCap = 'round';
            
            canvasContext.beginPath();
            canvasContext.moveTo(lastX, lastY);
            canvasContext.lineTo(x, y);
            canvasContext.stroke();
            
            [lastX, lastY] = [x, y];
            
            // æ¨¡æ‹Ÿå®æ—¶åŒæ­¥
            simulateCanvasSync(x, y);
        }
        
        // è·å–ç”»å¸ƒåæ ‡
        function getCanvasCoordinates(e) {
            const canvas = document.getElementById('collaborative-canvas');
            const rect = canvas.getBoundingClientRect();
            return [
                e.clientX - rect.left,
                e.clientY - rect.top
            ];
        }
        
        // åœæ­¢ç»˜åˆ¶
        function stopDrawing() {
            isDrawing = false;
            
            // æ¨¡æ‹Ÿç”¨æˆ·ç¦»å¼€
            setTimeout(() => {
                if (canvasUsers > 1) {
                    canvasUsers--;
                    document.getElementById('canvas-users').textContent = canvasUsers;
                }
            }, 5000);
        }
        
        // æ”¹å˜é¢œè‰²
        function changeColor(color) {
            currentColor = color;
        }
        
        // æ¸…ç©ºç”»å¸ƒ
        function clearCanvas() {
            const canvas = document.getElementById('collaborative-canvas');
            canvasContext.clearRect(0, 0, canvas.width, canvas.height);
            
            // é‡ç»˜èƒŒæ™¯å’Œåœ°å›¾
            canvasContext.fillStyle = 'white';
            canvasContext.fillRect(0, 0, canvas.width, canvas.height);
            drawCampusMap();
            
            addNotification(`${currentUser} æ¸…ç©ºäº†ç”»å¸ƒ`);
        }
        
        // æ¨¡æ‹Ÿç”»å¸ƒåŒæ­¥
        function simulateCanvasSync(x, y) {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šé€šè¿‡WebSocketå‘é€åæ ‡æ•°æ®
            // æ­¤å¤„ä»…æ¨¡æ‹Ÿ
            if (Math.random() > 0.7) {
                // æ¨¡æ‹Ÿå…¶ä»–ç”¨æˆ·çš„ç»˜åˆ¶
                setTimeout(() => {
                    const otherX = x + (Math.random() * 20 - 10);
                    const otherY = y + (Math.random() * 20 - 10);
                    
                    canvasContext.strokeStyle = ['#3498db', '#2ecc71', '#9b59b6'][Math.floor(Math.random() * 3)];
                    canvasContext.lineWidth = 2;
                    
                    canvasContext.beginPath();
                    canvasContext.moveTo(otherX - 5, otherY - 5);
                    canvasContext.lineTo(otherX + 5, otherY + 5);
                    canvasContext.stroke();
                }, 100);
            }
        }
        
        // åˆå§‹åŒ–å¼¹å¹•
        function startDanmaku() {
            const danmakuList = [
                "æ ¡å›­è‰ºæœ¯èŠ‚å¤ªæ£’äº†ï¼",
                "ä¸ºæˆ‘ä»¬çš„å­¦æ ¡ç‚¹èµï¼",
                "æœŸå¾…æ˜å¹´çš„æ–‡åŒ–èŠ‚",
                "åŒå­¦ä»¬çš„ä½œå“çœŸä¸é”™",
                "æ ¡å›­æ–‡åŒ–è¡«è®¾è®¡å¾—çœŸå¥½",
                "æ¯•ä¸šå­£ï¼Œå¥½èˆä¸å¾—",
                "å›¾ä¹¦é¦†æ–°è£…ä¿®çœŸæ¼‚äº®",
                "ä¸ºæ¯æ ¡éª„å‚²ï¼",
                "é’æ˜¥ä¸æ•£åœº",
                "æ ¡å›­ç”Ÿæ´»æœ€ç¾å¥½"
            ];
            
            // æ¯éš”ä¸€æ®µæ—¶é—´å‘é€ä¸€æ¡å¼¹å¹•
            setInterval(() => {
                if (Math.random() > 0.3) {
                    const randomIndex = Math.floor(Math.random() * danmakuList.length);
                    createDanmaku(danmakuList[randomIndex], ["å°æ˜", "å°çº¢", "å°åˆš", "æè€å¸ˆ"][Math.floor(Math.random() * 4)]);
                }
            }, 3000);
        }
        
        // åˆ›å»ºå¼¹å¹•
        function createDanmaku(text, user = currentUser) {
            const container = document.getElementById('danmaku-container');
            const danmaku = document.createElement('div');
            danmaku.className = 'danmaku';
            danmaku.textContent = `${user}: ${text}`;
            
            // éšæœºé¢œè‰²
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6'];
            danmaku.style.color = colors[Math.floor(Math.random() * colors.length)];
            
            // éšæœºä½ç½®
            const top = Math.random() * 80 + 10;
            danmaku.style.top = `${top}%`;
            
            // éšæœºé€Ÿåº¦
            const duration = Math.random() * 10 + 10;
            danmaku.style.animationDuration = `${duration}s`;
            
            container.appendChild(danmaku);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            danmaku.addEventListener('animationend', () => {
                danmaku.remove();
            });
        }
        
        // å‘é€å¼¹å¹•
        function sendDanmaku() {
            const input = document.getElementById('danmaku-input');
            const text = input.value.trim();
            
            if (text) {
                createDanmaku(text);
                input.value = '';
                
                addNotification(`${currentUser} å‘é€äº†å¼¹å¹•: ${text.substring(0, 20)}...`);
            }
        }
        
        // æ·»åŠ æ—¶ç©ºèƒ¶å›Š
        function addTimeCapsule() {
            const comment = document.getElementById('capsule-comment').value.trim();
            const date = document.getElementById('unlock-date').value;
            
            if (comment && date) {
                alert(`æ—¶ç©ºèƒ¶å›Šåˆ›å»ºæˆåŠŸï¼\nç•™è¨€: ${comment}\nè§£é”æ—¥æœŸ: ${date}`);
                document.getElementById('capsule-comment').value = '';
                
                addNotification(`${currentUser} åˆ›å»ºäº†ä¸€ä¸ªæ—¶ç©ºèƒ¶å›Šï¼Œå°†åœ¨ ${date} è§£é”`);
            } else {
                alert('è¯·å¡«å†™å®Œæ•´çš„æ—¶ç©ºèƒ¶å›Šä¿¡æ¯');
            }
        }
        
        // æ¸²æŸ“è¯„è®º
        function renderComments() {
            const container = document.getElementById('comments-container');
            container.innerHTML = '';
            
            comments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                commentElement.innerHTML = `
                    <div class="user-avatar">${comment.avatar}</div>
                    <div>
                        <div style="font-weight: bold;">${comment.user}</div>
                        <div>${comment.content}</div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">${comment.time}</div>
                    </div>
                `;
                container.appendChild(commentElement);
            });
        }
        
        // æ·»åŠ è¯„è®º
        function addComment() {
            const input = document.getElementById('new-comment');
            const text = input.value.trim();
            
            if (text) {
                const newComment = {
                    user: currentUser,
                    content: text,
                    time: 'åˆšåˆš',
                    avatar: currentUser.charAt(0)
                };
                
                comments.unshift(newComment);
                renderComments();
                input.value = '';
                
                // æ›´æ–°è¯„è®ºè®¡æ•°
                const commentCount = document.getElementById('comment-count');
                commentCount.textContent = parseInt(commentCount.textContent) + 1;
                
                addNotification(`${currentUser} å‘è¡¨äº†è¯„è®º: ${text.substring(0, 30)}...`);
            }
        }
        
        // æ·»åŠ é€šçŸ¥
        function addNotification(text) {
            const container = document.getElementById('notifications-container');
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            notification.innerHTML = `
                <i class="fas fa-bell" style="color: #e74c3c;"></i>
                <div>
                    <div>${text}</div>
                    <div style="font-size: 0.8rem; color: #666;">${time}</div>
                </div>
            `;
            
            container.insertBefore(notification, container.firstChild);
            
            // é™åˆ¶é€šçŸ¥æ•°é‡
            if (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }
        
        // æ¨¡æ‹ŸARé¢„è§ˆ
        function simulateAR() {
            const qrcode = document.getElementById('qrcode');
            qrcode.innerHTML = '<div style="text-align:center;"><div style="font-size:3rem;">ğŸ‘•</div><div style="font-size:0.8rem;">ARé¢„è§ˆä¸­...</div></div>';
            
            setTimeout(() => {
                qrcode.innerHTML = '<span style="font-size: 2rem;">ğŸ“±</span>';
                alert('ARé¢„è§ˆä½“éªŒå®Œæˆï¼åœ¨çœŸå®åº”ç”¨ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‰‹æœºæ‘„åƒå¤´æŸ¥çœ‹æ ¡å›­æ–‡åŒ–è¡«çš„ç©¿æˆ´æ•ˆæœã€‚');
            }, 2000);
        }
        
        // åˆå§‹åŒ–æ¨¡æ‹ŸWebSocketè¿æ¥
        function initSocketConnection() {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šå»ºç«‹çœŸæ­£çš„WebSocketè¿æ¥
            console.log('æ¨¡æ‹ŸWebSocketè¿æ¥å·²å»ºç«‹');
            
            // æ¨¡æ‹Ÿæ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯
            setInterval(() => {
                if (Math.random() > 0.5) {
                    const messages = [
                        "å°çº¢ ç‚¹èµäº†ä½ çš„ä½œå“",
                        "æè€å¸ˆ è¯„è®ºäº†æ ¡å›­æ´»åŠ¨",
                        "æ–°çš„æ ¡å›­æ´»åŠ¨å·²å‘å¸ƒ",
                        "3ä½ç”¨æˆ·æ­£åœ¨æŸ¥çœ‹ä½ çš„ä½œå“",
                        "æ ¡å›­æ–‡åŒ–è¡«æ–°å“ä¸Šæ¶"
                    ];
                    
                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    addNotification(randomMessage);
                }
            }, 8000);
        }
        
        // æ›´æ–°å®æ—¶æ•°æ®
        function updateRealTimeData() {
            // æ¨¡æ‹Ÿå®æ—¶æ•°æ®å˜åŒ–
            const viewCount = document.getElementById('view-count');
            const currentViews = parseInt(viewCount.textContent.replace(/,/g, ''));
            viewCount.textContent = (currentViews + Math.floor(Math.random() * 5)).toLocaleString();
            
            // æ¨¡æ‹Ÿåœ¨çº¿äººæ•°å˜åŒ–
            onlineCount += Math.floor(Math.random() * 3) - 1;
            onlineCount = Math.max(20, Math.min(30, onlineCount));
            document.getElementById('online-count').textContent = onlineCount;
            
            // éšæœºæ·»åŠ /ç§»é™¤åœ¨çº¿ç”¨æˆ·
            if (Math.random() > 0.7) {
                const users = ["å°æ˜", "å°çº¢", "å°åˆš", "æè€å¸ˆ", "ç‹åŒå­¦", "å¼ åŒå­¦", "åˆ˜è€å¸ˆ", "é™ˆåŒå­¦", "èµµåŒå­¦", "å‘¨è€å¸ˆ"];
                const newUser = users[Math.floor(Math.random() * users.length)];
                
                if (!onlineUsers.includes(newUser)) {
                    onlineUsers.push(newUser);
                } else if (onlineUsers.length > 5 && Math.random() > 0.5) {
                    // éšæœºç§»é™¤ä¸€ä¸ªç”¨æˆ·
                    onlineUsers.splice(Math.floor(Math.random() * onlineUsers.length), 1);
                }
                
                updateOnlineUsers();
            }
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('detail-modal');
            if (event.target === modal) {
                closeDetailModal();
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>